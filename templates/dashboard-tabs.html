<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ff6b6b">
    <meta name="description" content="Real-time DDoS/DoS Attack Honeypot Monitor">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <title>DDoSPoT Dashboard (Optimized)</title>
    
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" href="/static/logo-192.png">
    
    <link rel="stylesheet" href="/static/dashboard.css">
    <link rel="stylesheet" href="/static/mobile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    
    <style>
        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            gap: 8px;
            background: var(--surface);
            padding: 12px 20px;
            border-bottom: 2px solid var(--border);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 24px;
        }

        .tab-btn {
            padding: 10px 18px;
            background: var(--surface-light);
            border: 2px solid transparent;
            color: var(--text-muted);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-weight: 500;
            font-size: 14px;
        }

        .tab-btn:hover {
            background: var(--surface);
            color: var(--text);
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Accordion */
        .accordion-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .accordion-header {
            padding: 16px 20px;
            background: var(--surface-light);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s ease;
            user-select: none;
        }

        .accordion-header:hover {
            background: var(--surface);
        }

        .accordion-header h3 {
            margin: 0;
            font-size: 16px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .accordion-toggle {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--border);
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .accordion-header.active .accordion-toggle {
            transform: rotate(180deg);
            background: var(--primary);
            color: white;
        }

        .accordion-content {
            display: none;
            padding: 20px;
        }

        .accordion-content.active {
            display: block;
        }

        .stats-compact {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card-compact {
            background: var(--surface-light);
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid var(--primary);
        }

        .stat-card-compact .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .stat-card-compact .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .tab-navigation {
                padding: 8px 12px;
            }

            .tab-btn {
                padding: 8px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1>üçØ DDoSPoT Dashboard</h1>
                <p class="subtitle">Real-time DDoS/DoS Attack Honeypot Monitor</p>
            </div>
            <div class="header-status">
                <span id="status-indicator" class="status-indicator">‚óè</span>
                <span id="status-text">Connecting...</span>
                <div class="live-indicator">
                    <span class="live-pulse"></span>
                    <span class="live-text">LIVE</span>
                </div>
                <button id="dark-mode-toggle" class="theme-toggle" title="Toggle dark mode">üåô</button>
                <a href="/settings" class="theme-toggle" title="Settings">‚öôÔ∏è</a>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="overview">üìä Overview</button>
            <button class="tab-btn" data-tab="threats">üéØ Threats</button>
            <button class="tab-btn" data-tab="analysis">üìà Analysis</button>
            <button class="tab-btn" data-tab="intelligence">üîç Intel</button>
            <button class="tab-btn" data-tab="advanced">‚öôÔ∏è Advanced</button>
        </div>

        <main class="main-content">

            <!-- OVERVIEW TAB -->
            <div class="tab-content active" id="overview">
                <div class="accordion-section">
                    <div class="accordion-header active">
                        <h3>üìä Key Statistics</h3>
                        <div class="accordion-toggle">‚ñº</div>
                    </div>
                    <div class="accordion-content active">
                        <div class="stats-compact">
                            <div class="stat-card-compact">
                                <div class="stat-label">Total Events</div>
                                <div id="stat-total-events" class="stat-value">-</div>
                            </div>
                            <div class="stat-card-compact">
                                <div class="stat-label">Unique IPs</div>
                                <div id="stat-unique-ips" class="stat-value">-</div>
                            </div>
                            <div class="stat-card-compact">
                                <div class="stat-label">Blacklisted</div>
                                <div id="stat-blacklist" class="stat-value">-</div>
                            </div>
                            <div class="stat-card-compact">
                                <div class="stat-label">Top Protocol</div>
                                <div id="stat-top-protocol" class="stat-value">-</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-section">
                    <div class="accordion-header">
                        <h3>‚ö° Quick Actions</h3>
                        <div class="accordion-toggle">‚ñº</div>
                    </div>
                    <div class="accordion-content">
                        <button id="test-alert-btn" class="action-btn">üì§ Test Alert</button>
                        <a href="/settings" class="action-btn" style="display: inline-block; text-decoration: none;">‚öôÔ∏è Settings</a>
                        <button id="clear-alerts-btn" class="action-btn secondary" style="margin-left: 10px;">üóëÔ∏è Clear</button>
                    </div>
                </div>
            </div>

            <!-- THREATS TAB -->
            <div class="tab-content" id="threats">
                <div class="accordion-section">
                    <div class="accordion-header active">
                        <h3>üî¥ Recent Threats</h3>
                        <div class="accordion-toggle">‚ñº</div>
                    </div>
                    <div class="accordion-content active">
                        <div id="alerts-container" class="alerts-list">
                            <div class="loading">Loading threats...</div>
                        </div>
                    </div>
                </div>

                <div class="accordion-section">
                    <div class="accordion-header">
                        <h3>üó∫Ô∏è Attack Map</h3>
                        <div class="accordion-toggle">‚ñº</div>
                    </div>
                    <div class="accordion-content">
                        <div id="map" style="height: 400px; border-radius: 6px;"></div>
                    </div>
                </div>
            </div>

            <!-- ANALYSIS TAB -->
            <div class="tab-content" id="analysis">
                <div class="accordion-section">
                    <div class="accordion-header active">
                        <h3>üìä Protocol Breakdown</h3>
                        <div class="accordion-toggle">‚ñº</div>
                    </div>
                    <div class="accordion-content active">
                        <canvas id="protocol-chart" style="max-height: 300px;"></canvas>
                    </div>
                </div>

                <div class="accordion-section">
                    <div class="accordion-header">
                        <h3>üìà Hourly Trend</h3>
                        <div class="accordion-toggle">‚ñº</div>
                    </div>
                    <div class="accordion-content">
                        <canvas id="hourly-chart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- INTELLIGENCE TAB -->
            <div class="tab-content" id="intelligence">
                <div class="accordion-section">
                    <div class="accordion-header active">
                        <h3>üîç Advanced Search</h3>
                        <div class="accordion-toggle">‚ñº</div>
                    </div>
                    <div class="accordion-content active">
                        <div class="search-controls">
                            <div class="search-row">
                                <input type="text" id="search-ip" placeholder="Search IP..." class="search-input">
                                <select id="search-protocol" class="search-input">
                                    <option value="">All Protocols</option>
                                    <option value="SSH">SSH</option>
                                    <option value="HTTP">HTTP</option>
                                    <option value="SSDP">SSDP</option>
                                </select>
                                <button id="search-btn" class="action-btn">üîé Search</button>
                            </div>
                        </div>
                        <div id="search-results" class="table-container" style="margin-top: 15px;">
                            <p style="text-align: center; color: var(--text-muted);">Click Search to find threats</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ADVANCED TAB -->
            <div class="tab-content" id="advanced">
                <div class="accordion-section">
                    <div class="accordion-header active">
                        <h3>üö® Alert Rules</h3>
                        <div class="accordion-toggle">‚ñº</div>
                    </div>
                    <div class="accordion-content active">
                        <button id="new-rule-btn" class="action-btn">‚ûï New Rule</button>
                        <div id="rules-list" style="margin-top: 15px;">
                            <div class="loading">Loading rules...</div>
                        </div>
                    </div>
                </div>

                <div class="accordion-section">
                    <div class="accordion-header">
                        <h3>üìã Blacklist</h3>
                        <div class="accordion-toggle">‚ñº</div>
                    </div>
                    <div class="accordion-content">
                        <div id="blacklist-container" class="table-container">
                            <div class="loading">Loading blacklist...</div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    
    <script>
        // Theme toggle
        document.getElementById('dark-mode-toggle').addEventListener('click', function() {
            document.body.classList.toggle('light-mode');
            const isDark = !document.body.classList.contains('light-mode');
            localStorage.setItem('ddospot-theme', isDark ? 'dark' : 'light');
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('ddospot-theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-mode');
        }

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Remove active class from buttons
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('active');
                });
                
                // Show selected tab
                document.getElementById(tabName).classList.add('active');
                this.classList.add('active');
            });
        });

        // Accordion toggle
        document.querySelectorAll('.accordion-header').forEach(header => {
            header.addEventListener('click', function() {
                this.classList.toggle('active');
                this.nextElementSibling.classList.toggle('active');
            });
        });

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/static/service-worker.js')
                .then(reg => console.log('‚úÖ Service Worker registered'))
                .catch(err => console.log('Service Worker failed:', err));
        }

        console.log('‚úÖ Dashboard Ready!');
    </script>

    <!-- Load main dashboard data -->
    <script src="/static/dashboard.js"></script>
</body>
</html>
