<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDoSPot Advanced Dashboard</title>
    <link rel="stylesheet" href="/static/dashboard-clean.css?v=20260131f">
    <link rel="stylesheet" href="/static/threat-intel.css?v=20260131f">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
        // Initialize theme immediately to prevent flash
        const savedTheme = localStorage.getItem('ddospot-theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-mode');
        }
        console.log('üçØ DDoSPoT Advanced Dashboard Loading...');
    </script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1>üçØ DDoSPoT Advanced Dashboard</h1>
                <p class="subtitle">Professional-Grade Real-time DDoS/DoS Attack Honeypot Monitor</p>
            </div>
            <div class="header-status">
                <span id="status-indicator" class="status-indicator">‚óè</span>
                <span id="status-text">Connecting...</span>
                <div class="live-indicator">
                    <span class="live-pulse"></span>
                    <span class="live-text">LIVE</span>
                    <span class="last-updated">Updated: <span id="update-time">just now</span></span>
                </div>
                <button id="dark-mode-toggle" class="theme-toggle" title="Toggle dark mode">üåô</button>
                <button id="layout-settings-btn" class="theme-toggle" title="Dashboard layout settings">‚öôÔ∏è</button>
                <button id="alert-settings-btn" class="theme-toggle" title="Configure alert thresholds">üîî</button>
                <button id="pause-refresh-btn" class="theme-toggle" title="Pause/Resume refresh">‚ñ∂Ô∏è</button>
                <div class="refresh-control">
                    <label for="refresh-interval">Refresh:</label>
                    <select id="refresh-interval">
                        <option value="real-time" selected>‚ö° Real-time (1s)</option>
                        <option value="5000">5s</option>
                        <option value="10000">10s</option>
                        <option value="30000">30s</option>
                        <option value="60000">60s</option>
                    </select>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Statistics Grid -->
            <section class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-info">
                        <div class="stat-label">Total Events (24h)</div>
                        <div id="stat-total-events" class="stat-value">-</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-info">
                        <div class="stat-label">Unique Attackers</div>
                        <div id="stat-unique-ips" class="stat-value">-</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üö´</div>
                    <div class="stat-info">
                        <div class="stat-label">Blacklisted IPs</div>
                        <div id="stat-blacklist" class="stat-value">-</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-info">
                        <div class="stat-label">Top Protocol</div>
                        <div id="stat-top-protocol" class="stat-value">-</div>
                    </div>
                </div>
            </section>

            <!-- Alerts Section -->
            <section class="section" data-section="alerts">
                <h2>üîî Recent Alerts</h2>
                <div class="alerts-controls">
                    <button id="test-alert-btn" class="action-btn">üì§ Send Test Alert</button>
                    <button id="clear-alerts-btn" class="action-btn secondary">üóëÔ∏è Clear History</button>
                </div>
                <div id="alerts-container" class="alerts-list">
                    <div class="loading">Loading alerts...</div>
                </div>
            </section>

            <!-- Advanced Search & Filtering -->
            <section class="section search-section" data-section="search">
                <h2>üîç Advanced Search & Filtering</h2>
                <div class="search-controls">
                    <div class="search-row">
                        <input type="text" id="search-ip" placeholder="Search by IP address" class="search-input">
                        <input type="text" id="search-date-from" placeholder="From (YYYY-MM-DD)" class="search-input">
                        <input type="text" id="search-date-to" placeholder="To (YYYY-MM-DD)" class="search-input">
                    </div>
                    <div class="search-row">
                        <select id="search-protocol" class="search-input">
                            <option value="">All Protocols</option>
                            <option value="SSH">SSH</option>
                            <option value="HTTP">HTTP</option>
                            <option value="SSDP">SSDP</option>
                            <option value="DNS">DNS</option>
                        </select>
                        <select id="search-country" class="search-input">
                            <option value="">All Countries</option>
                        </select>
                        <select id="search-hours" class="search-input">
                            <option value="1">Last 1 hour</option>
                            <option value="6">Last 6 hours</option>
                            <option value="24" selected>Last 24 hours</option>
                            <option value="72">Last 3 days</option>
                            <option value="168">Last 7 days</option>
                            <option value="720">Last 30 days</option>
                        </select>
                    </div>
                    <div class="search-row">
                        <button id="search-btn" class="action-btn">üîé Search</button>
                        <button id="search-reset-btn" class="action-btn secondary">‚Üª Reset</button>
                        <button id="search-export-btn" class="export-btn">üì• Export Results</button>
                    </div>
                </div>
                <div id="search-results" class="table-container">
                    <div style="padding: 20px; text-align: center; color: #999;">
                        Click "Search" to find attacks by IP, date, country, or protocol
                    </div>
                </div>
            </section>

            <!-- Alert Rules Section -->
            <section class="section alert-rules-section">
                <h2>üö® Custom Alert Rules</h2>
                
                <div class="alert-rules-controls">
                    <button id="new-rule-btn" class="action-btn">‚ûï New Alert Rule</button>
                    <button id="refresh-rules-btn" class="action-btn secondary">‚Üª Refresh</button>
                </div>

                <!-- Rule Creation Form (Hidden by default) -->
                <div id="rule-form-container" class="rule-form-container" style="display: none;">
                    <div class="rule-form">
                        <h3>Create New Alert Rule</h3>
                        
                        <div class="form-group">
                            <label>Rule Name:</label>
                            <input type="text" id="rule-name" placeholder="e.g., High Volume Attack" class="form-input">
                        </div>

                        <div class="form-group">
                            <label>Description:</label>
                            <textarea id="rule-description" placeholder="Optional description" class="form-input"></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Condition Type:</label>
                                <select id="rule-condition-type" class="form-input">
                                    <option value="event_count">Event Count</option>
                                    <option value="ip_address">IP Address</option>
                                    <option value="protocol">Protocol</option>
                                    <option value="payload_size">Payload Size</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Field:</label>
                                <select id="rule-condition-field" class="form-input">
                                    <option value="source_ip">Source IP</option>
                                    <option value="protocol">Protocol</option>
                                    <option value="port">Port</option>
                                    <option value="payload_size">Payload Size</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Operator:</label>
                                <select id="rule-condition-operator" class="form-input">
                                    <option value="==">=</option>
                                    <option value="!=">‚â†</option>
                                    <option value="contains">Contains</option>
                                    <option value="not_contains">Not Contains</option>
                                    <option value=">">></option>
                                    <option value="<"><</option>
                                    <option value=">=">‚â•</option>
                                    <option value="<=">‚â§</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Value:</label>
                                <input type="text" id="rule-condition-value" placeholder="e.g., 192.168.1.1 or 100" class="form-input">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Action:</label>
                                <select id="rule-action" class="form-input">
                                    <option value="log">Log Only</option>
                                    <option value="notify">Notify</option>
                                    <option value="block">Block IP</option>
                                    <option value="webhook">Send Webhook</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Action Target (optional):</label>
                                <input type="text" id="rule-action-target" placeholder="e.g., email@example.com or webhook URL" class="form-input">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Threshold:</label>
                                <input type="number" id="rule-threshold" value="1" min="1" max="1000" class="form-input">
                            </div>

                            <div class="form-group">
                                <label>Time Window (minutes):</label>
                                <input type="number" id="rule-time-window" value="1" min="1" max="1440" class="form-input">
                            </div>
                        </div>

                        <div class="form-actions">
                            <button id="save-rule-btn" class="action-btn">‚úÖ Save Rule</button>
                            <button id="cancel-rule-btn" class="action-btn secondary">‚úï Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Rules List -->
                <div id="rules-list" class="rules-list">
                    <div style="padding: 20px; text-align: center; color: #999;">
                        Loading alert rules...
                    </div>
                </div>
            </section>

            <!-- Attack Pattern Reports Section -->
            <section class="section reports-section" data-section="reports">
                <h2>üìä Attack Pattern Reports</h2>
                
                <div class="report-controls">
                    <select id="report-type" class="report-input">
                        <option value="patterns">Attack Patterns</option>
                        <option value="statistics">Detailed Statistics</option>
                        <option value="daily">Daily Summary</option>
                        <option value="timeline">Attack Timeline</option>
                    </select>
                    
                    <select id="report-time-period" class="report-input">
                        <option value="6">Last 6 hours</option>
                        <option value="24">Last 24 hours</option>
                        <option value="72">Last 3 days</option>
                        <option value="168">Last 7 days</option>
                        <option value="360">Last 15 days</option>
                        <option value="720" selected>Last 30 days</option>
                    </select>
                    
                    <button id="generate-report-btn" class="action-btn">üìà Generate Report</button>
                    <button id="export-report-json" class="action-btn secondary">‚¨á Export JSON</button>
                    <button id="export-report-csv" class="action-btn secondary">‚¨á Export CSV</button>
                </div>

                <!-- Report Display -->
                <div id="report-container" class="report-container">
                    <div style="padding: 40px 20px; text-align: center; color: #999;">
                        <p>üìã Select a report type and click "Generate Report"</p>
                    </div>
                </div>
            </section>

            <!-- Charts Section -->
            <section class="section" data-section="charts">
                <div class="chart-container">
                    <h2>Attack Timeline</h2>
                    <canvas id="timeline-chart"></canvas>
                </div>
                <div class="chart-container">
                    <h2>Protocol Breakdown</h2>
                    <canvas id="protocol-chart"></canvas>
                </div>
                <div class="chart-container full-width">
                    <h2>üî• Attack Intensity Heatmap (30d)</h2>
                    <p style="font-size: 12px; color: #999; margin-bottom: 10px;">Darker = More intense attacks</p>
                    <canvas id="heatmap-chart"></canvas>
                </div>
            </section>

            <!-- Top Attackers Section -->
            <section class="section" data-section="attackers">
                <h2>üî¥ Top Attacking IPs</h2>
                <div class="filter-bar">
                    <input type="text" id="filter-attackers-ip" placeholder="Filter by IP" class="filter-input">
                    <select id="filter-attackers-severity" class="filter-input">
                        <option value="">All Severities</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                        <option value="critical">Critical</option>
                    </select>
                    <button id="export-attackers" class="export-btn">üì• Export CSV</button>
                </div>
                <div id="top-attackers" class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>IP Address</th>
                                <th>Events</th>
                                <th>Type</th>
                                <th>Rate/min</th>
                                <th>Protocols</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="attackers-tbody">
                            <tr><td colspan="6" class="loading">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Blacklist Section -->
            <section class="section" data-section="blacklist">
                <h2>üö´ Active Blacklist</h2>
                <div class="filter-bar">
                    <input type="text" id="filter-blacklist-ip" placeholder="Filter by IP" class="filter-input">
                    <select id="filter-blacklist-reason" class="filter-input">
                        <option value="">All Reasons</option>
                        <option value="volumetric">Volumetric</option>
                        <option value="multi-protocol">Multi-Protocol</option>
                        <option value="sustained">Sustained</option>
                        <option value="escalating">Escalating</option>
                    </select>
                    <button id="export-blacklist" class="export-btn">üì• Export CSV</button>
                </div>
                <div id="blacklist-container" class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>IP Address</th>
                                <th>Reason</th>
                                <th>Severity</th>
                                <th>Expires In</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="blacklist-tbody">
                            <tr><td colspan="4" class="loading">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Recent Events Section -->
            <section class="section" data-section="events">
                <h2>üì° Recent Attack Events</h2>
                <div class="filter-bar">
                    <input type="text" id="filter-events-ip" placeholder="Filter by IP" class="filter-input">
                    <select id="filter-events-protocol" class="filter-input">
                        <option value="">All Protocols</option>
                        <option value="HTTP">HTTP</option>
                        <option value="SSH">SSH</option>
                        <option value="DNS">DNS</option>
                        <option value="SSDP">SSDP</option>
                    </select>
                    <select id="filter-events-type" class="filter-input">
                        <option value="">All Types</option>
                        <option value="GET">GET Request</option>
                        <option value="POST">POST Request</option>
                        <option value="UDP Flood">UDP Flood</option>
                    </select>
                    <select id="events-page-size" class="filter-input">
                        <option value="20">20</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                    </select>
                    <button id="export-events" class="export-btn">üì• Export CSV</button>
                </div>
                <div id="recent-events" class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>IP</th>
                                <th>Port</th>
                                <th>Protocol</th>
                                <th>Size</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody id="events-tbody">
                            <tr><td colspan="6" class="loading">Loading...</td></tr>
                        </tbody>
                    </table>
                    <div class="pagination">
                        <button id="events-prev" class="action-btn secondary">‚Üê Prev</button>
                        <span id="events-page-info">Page 1</span>
                        <button id="events-next" class="action-btn">Next ‚Üí</button>
                    </div>
                </div>
            </section>

            <!-- Real-Time Log Viewer -->
            <section class="section live-logs-section" data-section="logs">
                <h2>üì∫ Real-Time Log Viewer</h2>
                <div class="live-controls">
                    <button id="live-pause-btn" class="action-btn" data-state="playing">‚è∏Ô∏è Pause</button>
                    <button id="live-clear-btn" class="action-btn secondary">üóëÔ∏è Clear Logs</button>
                    <label for="live-filter-protocol">Protocol:</label>
                    <select id="live-filter-protocol" class="live-filter-input">
                        <option value="">All</option>
                    </select>
                    <label for="live-filter-port">Port:</label>
                    <select id="live-filter-port" class="live-filter-input">
                        <option value="">All</option>
                    </select>
                    <label for="live-filter-ip">IP:</label>
                    <input type="text" id="live-filter-ip" placeholder="Filter by IP" class="live-filter-input">
                    <span class="live-status">
                        <span class="live-pulse-small"></span>
                        <span id="live-event-count">0 events</span>
                    </span>
                </div>
                <div id="live-logs-container" class="live-logs-container">
                    <div class="live-logs-table">
                        <div class="live-logs-header">
                            <div class="log-column log-time">Time</div>
                            <div class="log-column log-ip">Source IP</div>
                            <div class="log-column log-port">Port</div>
                            <div class="log-column log-protocol">Protocol</div>
                            <div class="log-column log-size">Payload</div>
                            <div class="log-column log-type">Type</div>
                        </div>
                        <div id="live-logs-body" class="live-logs-body">
                            <div class="live-log-entry placeholder">Waiting for events...</div>
                        </div>
                    </div>
                </div>
                <div class="live-stats">
                    <div class="live-stat">
                        <span class="live-stat-label">Events/min:</span>
                        <span id="live-events-per-min" class="live-stat-value">0</span>
                    </div>
                    <div class="live-stat">
                        <span class="live-stat-label">Unique IPs:</span>
                        <span id="live-unique-ips" class="live-stat-value">0</span>
                    </div>
                    <div class="live-stat">
                        <span class="live-stat-label">Protocols:</span>
                        <span id="live-protocol-count" class="live-stat-value">0</span>
                    </div>
                </div>
            </section>

            <!-- ML Anomaly Detection Section -->
            <section class="section anomaly-section" data-section="anomaly">
                <h2>ü§ñ ML Anomaly Detection</h2>
                <div class="anomaly-controls">
                    <button id="anomaly-scan-btn" class="action-btn">üîç Scan for Anomalies</button>
                    <label for="anomaly-hours">Period:</label>
                    <select id="anomaly-hours" class="filter-input">
                        <option value="6">Last 6 hours</option>
                        <option value="24">Last 24 hours</option>
                        <option value="72">Last 3 days</option>
                        <option value="168">Last 7 days</option>
                        <option value="720" selected>Last 30 days</option>
                    </select>
                    <label for="anomaly-sensitivity">Sensitivity:</label>
                    <select id="anomaly-sensitivity" class="filter-input">
                        <option value="1">Low (1.0x)</option>
                        <option value="2" selected>Medium (2.0x)</option>
                        <option value="3">High (3.0x)</option>
                        <option value="4">Very High (4.0x)</option>
                    </select>
                </div>

                <!-- Anomaly Summary -->
                <div class="anomaly-summary">
                    <div class="summary-stat anomaly-stat">
                        <div class="stat-value" id="anomaly-count">-</div>
                        <div class="stat-label">Anomalies Detected</div>
                    </div>
                    <div class="summary-stat anomaly-stat">
                        <div class="stat-value" id="anomaly-severity">-</div>
                        <div class="stat-label">Overall Severity</div>
                    </div>
                    <div class="summary-stat anomaly-stat">
                        <div class="stat-value" id="anomaly-type-count">-</div>
                        <div class="stat-label">Anomaly Types</div>
                    </div>
                    <div class="summary-stat anomaly-stat">
                        <div class="stat-value" id="anomaly-suspicious-ips">-</div>
                        <div class="stat-label">Suspicious IPs</div>
                    </div>
                </div>

                <!-- Anomalies Table -->
                <div class="anomaly-details">
                    <h3>Detected Anomalies</h3>
                    <div class="table-container">
                        <table class="data-table anomaly-table">
                            <thead>
                                <tr>
                                    <th>Score</th>
                                    <th>Type</th>
                                    <th>Source IP</th>
                                    <th>Details</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="anomaly-tbody">
                                <tr><td colspan="5" class="loading">Click "Scan for Anomalies" to detect...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Anomaly Type Distribution -->
                <div class="anomaly-breakdown">
                    <h3>Anomaly Type Distribution</h3>
                    <div id="anomaly-type-breakdown" class="type-breakdown">
                        <div class="loading">Waiting for scan...</div>
                    </div>
                </div>
            </section>

            <!-- Database Info Section -->
            <section class="section" data-section="database">
                <h2>üíæ Database Information</h2>
                <div id="db-info" class="info-cards">
                    <div class="info-card">
                        <div class="info-label">Database Size</div>
                        <div id="db-size" class="info-value">-</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Total Events</div>
                        <div id="db-events" class="info-value">-</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">IP Profiles</div>
                        <div id="db-profiles" class="info-value">-</div>
                    </div>
                </div>
            </section>

            <!-- Geolocation Map Section -->
            <section class="section geo-section" data-section="map">
                <h2>üåç Geographic Heat Map</h2>
                <p class="section-description">Global distribution of attacking IPs and attack volume by location</p>
                
                <div class="geo-controls">
                    <button id="geo-load-btn" class="action-btn">üåç Load Locations</button>
                    <button id="geo-clear-btn" class="action-btn secondary">üóëÔ∏è Clear Map</button>
                    <label for="geo-time-period">Period:</label>
                    <select id="geo-time-period" class="filter-input">
                        <option value="6">Last 6 hours</option>
                        <option value="24" selected>Last 24 hours</option>
                        <option value="72">Last 3 days</option>
                        <option value="168">Last 7 days</option>
                    </select>
                </div>
                
                <div id="map" class="geo-map"></div>
                
                <div class="geo-stats">
                    <h3>üî¥ Attack Distribution by Country</h3>
                    <div id="country-stats" class="country-stats-container">
                        <div class="loading">Click "Load Locations" to populate map...</div>
                    </div>
                </div>
            </section>

            <!-- Threat Intelligence Section -->
            <section class="section threat-section" data-section="threat">
                <h2>‚ö†Ô∏è Threat Intelligence</h2>
                <div class="threat-controls">
                    <button id="threat-scan-btn" class="action-btn">üîç Scan Threats</button>
                    <button id="threat-high-risk-btn" class="action-btn secondary">üö® High Risk IPs</button>
                    <label for="threat-threshold">Risk Threshold:</label>
                    <select id="threat-threshold" class="filter-input">
                        <option value="4">Medium (4+)</option>
                        <option value="7" selected>High (7+)</option>
                        <option value="9">Critical (9+)</option>
                    </select>
                </div>

                <!-- Threat Summary -->
                <div class="threat-summary">
                    <div class="threat-stat critical-stat">
                        <div class="stat-value" id="threat-critical">-</div>
                        <div class="stat-label">Critical</div>
                    </div>
                    <div class="threat-stat high-stat">
                        <div class="stat-value" id="threat-high">-</div>
                        <div class="stat-label">High</div>
                    </div>
                    <div class="threat-stat medium-stat">
                        <div class="stat-value" id="threat-medium">-</div>
                        <div class="stat-label">Medium</div>
                    </div>
                    <div class="threat-stat low-stat">
                        <div class="stat-value" id="threat-low">-</div>
                        <div class="stat-label">Low</div>
                    </div>
                </div>

                <!-- High-Risk IPs Table -->
                <div class="threat-details">
                    <h3>üö® High-Risk Threatening IPs</h3>
                    <div class="table-container">
                        <table class="data-table threat-table">
                            <thead>
                                <tr>
                                    <th>IP Address</th>
                                    <th>Risk Score</th>
                                    <th>Threat Type</th>
                                    <th>Description</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="threat-tbody">
                                <tr><td colspan="5" class="loading">Click "Scan Threats" to analyze...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Threat Type Distribution -->
                <div class="threat-breakdown">
                    <h3>Threat Type Distribution</h3>
                    <div id="threat-type-breakdown" class="type-breakdown">
                        <div class="loading">Waiting for threat scan...</div>
                    </div>
                </div>
            </section>

            <!-- Automated Response Actions Section -->
            <section class="section response-section" data-section="response">
                <h2>üõ°Ô∏è Automated Response Actions</h2>
                <div class="response-controls">
                    <button id="response-block-btn" class="action-btn danger">üö´ Block IP</button>
                    <button id="response-webhook-btn" class="action-btn secondary">üîó Add Webhook</button>
                    <button id="response-refresh-btn" class="action-btn">üîÑ Refresh</button>
                </div>

                <!-- Response Statistics -->
                <div class="response-summary">
                    <div class="response-stat blocked-count">
                        <div class="stat-value" id="response-blocked">0</div>
                        <div class="stat-label">Blocked IPs</div>
                    </div>
                    <div class="response-stat webhook-count">
                        <div class="stat-value" id="response-webhooks">0</div>
                        <div class="stat-label">Active Webhooks</div>
                    </div>
                    <div class="response-stat action-count">
                        <div class="stat-value" id="response-actions">0</div>
                        <div class="stat-label">Actions Taken</div>
                    </div>
                </div>

                <!-- Blocked IPs Table -->
                <div class="response-details">
                    <h3>üö´ Currently Blocked IPs</h3>
                    <div class="table-container">
                        <table class="data-table response-table">
                            <thead>
                                <tr>
                                    <th>IP Address</th>
                                    <th>Reason</th>
                                    <th>Threat Type</th>
                                    <th>Risk Score</th>
                                    <th>Blocked At</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="response-tbody">
                                <tr><td colspan="6" class="loading">Click "Refresh" to load blocked IPs...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Action History -->
                <div class="action-history">
                    <h3>üìã Recent Actions</h3>
                    <div id="action-history-list" class="action-history-list">
                        <div class="loading">Loading action history...</div>
                    </div>
                </div>
            </section>

            <!-- Export Section -->
            <!-- API Key Management Section -->
            <section class="section api-keys-section" data-section="api-keys">
                <h2>üîë API Key Management</h2>
                <p class="section-description">Create, manage, and revoke API keys for programmatic access</p>
                
                <div class="api-keys-container">
                    <!-- Create New Key -->
                    <div class="api-key-create-section">
                        <h3>Create New API Key</h3>
                        <div class="api-key-form">
                            <input type="text" id="api-key-name" placeholder="Key name (e.g., 'Mobile App', 'Monitoring')" class="form-input">
                            <div class="permissions-checkboxes">
                                <label class="permission-label">
                                    <input type="checkbox" class="api-permission" value="read" checked>
                                    <span>Read (View data)</span>
                                </label>
                                <label class="permission-label">
                                    <input type="checkbox" class="api-permission" value="write">
                                    <span>Write (Modify data)</span>
                                </label>
                                <label class="permission-label">
                                    <input type="checkbox" class="api-permission" value="admin">
                                    <span>Admin (Full access)</span>
                                </label>
                            </div>
                            <button id="api-key-create-btn" class="action-btn">‚ûï Create Key</button>
                        </div>
                    </div>

                    <!-- API Keys List -->
                    <div class="api-keys-list-section">
                        <h3>Your API Keys</h3>
                        <div id="api-keys-list" class="api-keys-table-container">
                            <div class="loading">Loading API keys...</div>
                        </div>
                    </div>

                    <!-- New Key Display -->
                    <div id="api-key-display" class="api-key-display" style="display: none;">
                        <h3>‚úÖ API Key Created Successfully</h3>
                        <p class="warning-text">‚ö†Ô∏è Save this key now - you won't be able to see it again!</p>
                        <div class="api-key-box">
                            <code id="new-api-key-value"></code>
                            <button id="copy-api-key-btn" class="action-btn secondary">üìã Copy</button>
                        </div>
                        <button id="close-api-key-display" class="action-btn secondary">Close</button>
                    </div>
                </div>
            </section>

            <!-- Rate Limit Dashboard Section -->
            <section class="section rate-limit-section" data-section="rate-limits">
                <h2>‚è±Ô∏è Rate Limit Usage</h2>
                <p class="section-description">Monitor API rate limits and blacklist status</p>
                
                <div class="rate-limit-container">
                    <!-- Current Usage -->
                    <div class="rate-limit-card usage-card">
                        <div class="card-icon">üìä</div>
                        <h3>Your Current Usage</h3>
                        <div class="usage-bar-container">
                            <div class="usage-bar-background">
                                <div id="usage-bar-fill" class="usage-bar-fill" style="width: 0%;">
                                    <span id="usage-percentage" class="usage-percentage">0%</span>
                                </div>
                            </div>
                        </div>
                        <div class="usage-stats" id="usage-stats-text">0 / 300 requests</div>
                        <div class="usage-window" id="usage-window-text">Reset in 60 seconds</div>
                    </div>

                    <!-- Status Info -->
                    <div class="rate-limit-card status-card">
                        <div class="card-icon">üîç</div>
                        <h3>Status</h3>
                        <div class="status-items">
                            <div class="status-item">
                                <span class="status-label">Your IP:</span>
                                <code id="status-current-ip" class="status-value">...</code>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Whitelisted:</span>
                                <span id="status-whitelist" class="status-badge">No</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Blacklisted:</span>
                                <span id="status-current-blacklisted" class="status-badge">No</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Total Blacklisted IPs:</span>
                                <strong id="status-blacklist-count">0</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Configuration -->
                    <div class="rate-limit-card config-card">
                        <div class="card-icon">‚öôÔ∏è</div>
                        <h3>Configuration</h3>
                        <div class="config-items">
                            <div class="config-item">
                                <span class="config-label">Requests Limit:</span>
                                <strong id="config-limit-max">300</strong>
                            </div>
                            <div class="config-item">
                                <span class="config-label">Time Window:</span>
                                <strong id="config-limit-window">60</strong> seconds
                            </div>
                            <div class="config-item">
                                <span class="config-label">Blacklist Duration:</span>
                                <strong id="config-blacklist-duration">120</strong> seconds
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Blacklisted IPs Table -->
                <div class="blacklist-section">
                    <h3>Currently Blacklisted IPs</h3>
                    <div id="blacklist-ips-list" class="blacklist-table-container">
                        <div class="blacklist-empty">No IPs currently blacklisted</div>
                    </div>
                </div>

                <!-- Top IPs by Request Count -->
                <div class="top-ips-section">
                    <h3>Top IPs by Request Count</h3>
                    <div id="top-ips-list" class="top-ips-table-container">
                        <div class="top-ips-empty">No request data available</div>
                    </div>
                </div>

                <!-- Refresh Section -->
                <div class="rate-limit-refresh">
                    <span class="last-updated" id="rate-limit-last-updated">Last updated: never</span>
                    <button id="rate-limit-refresh-btn" class="action-btn primary">üîÑ Refresh Now</button>
                </div>
            </section>

                <div class="rate-limit-refresh">
                    <button id="refresh-rate-limits" class="action-btn">üîÑ Refresh Now</button>
                    <span id="last-updated" class="last-updated">Last updated: never</span>
                </div>
            </section>

            <!-- Performance Metrics Dashboard Section -->
            <section class="section performance-section" data-section="performance">
                <h2>‚ö° Performance Metrics</h2>
                <p class="section-description">Monitor API response times, throughput, and system resources</p>
                
                <!-- Metrics Summary Cards -->
                <div class="performance-grid">
                    <!-- Response Times -->
                    <div class="perf-card">
                        <div class="card-icon">‚è±Ô∏è</div>
                        <h3>Response Times</h3>
                        <div class="perf-metric">
                            <span class="metric-label">Average</span>
                            <span id="perf-avg-response" class="metric-value">-- ms</span>
                        </div>
                        <div class="perf-metric">
                            <span class="metric-label">Min / Max</span>
                            <span id="perf-minmax-response" class="metric-value">-- / -- ms</span>
                        </div>
                    </div>

                    <!-- Throughput -->
                    <div class="perf-card">
                        <div class="card-icon">üöÄ</div>
                        <h3>Throughput</h3>
                        <div class="perf-metric">
                            <span class="metric-label">Requests/sec</span>
                            <span id="perf-rps" class="metric-value">-- req/s</span>
                        </div>
                        <div class="perf-metric">
                            <span class="metric-label">Error Rate</span>
                            <span id="perf-error-rate" class="metric-value" style="color: #ff6b6b;">-- %</span>
                        </div>
                    </div>

                    <!-- Database Performance -->
                    <div class="perf-card">
                        <div class="card-icon">üóÑÔ∏è</div>
                        <h3>Database</h3>
                        <div class="perf-metric">
                            <span class="metric-label">Avg Query Time</span>
                            <span id="perf-db-avg" class="metric-value">-- ms</span>
                        </div>
                        <div class="perf-metric">
                            <span class="metric-label">Total Queries</span>
                            <span id="perf-db-total" class="metric-value">--</span>
                        </div>
                    </div>

                    <!-- System Resources -->
                    <div class="perf-card">
                        <div class="card-icon">üíæ</div>
                        <h3>System Resources</h3>
                        <div class="perf-metric">
                            <span class="metric-label">CPU</span>
                            <span id="perf-cpu" class="metric-value">-- %</span>
                        </div>
                        <div class="perf-metric">
                            <span class="metric-label">Memory</span>
                            <span id="perf-memory" class="metric-value">-- MB</span>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="performance-charts">
                    <!-- Response Time Chart -->
                    <div class="chart-container">
                        <h3>Response Time Trend</h3>
                        <canvas id="perf-response-chart"></canvas>
                    </div>

                    <!-- Throughput Chart -->
                    <div class="chart-container">
                        <h3>Throughput & Errors</h3>
                        <canvas id="perf-throughput-chart"></canvas>
                    </div>
                </div>

                <!-- Endpoint Statistics -->
                <div class="endpoint-stats-section">
                    <h3>Endpoint Performance</h3>
                    <div id="perf-endpoints-table" class="endpoints-table-container">
                        <div class="table-placeholder">Loading endpoint statistics...</div>
                    </div>
                </div>

                <!-- Uptime and Refresh -->
                <div class="perf-controls">
                    <div class="perf-info">
                        <span id="perf-uptime" class="uptime">Uptime: --</span>
                        <span id="perf-last-update" class="last-update">Last updated: --</span>
                    </div>
                    <button id="perf-refresh-btn" class="action-btn primary">üîÑ Refresh Now</button>
                </div>
            </section>

            <!-- Threat Intelligence Section -->
            <section class="section threat-intel-section" data-section="threat-intel">
                <h2>üéØ Threat Intelligence & IP Reputation</h2>
                <p class="section-description">Advanced threat analysis, WHOIS lookups, and IP reputation scoring</p>
                
                <!-- Search for IP -->
                <div class="threat-intel-search">
                    <input type="text" id="threat-intel-ip-input" placeholder="Enter IP address to analyze..." class="search-input">
                    <button id="threat-intel-search-btn" class="action-btn primary">üîç Analyze</button>
                    <button id="threat-intel-clear-btn" class="action-btn">Clear</button>
                </div>

                <!-- Threat Profile Display -->
                <div id="threat-intel-results" class="threat-intel-results" style="display: none;">
                    <!-- Reputation Score Card -->
                    <div class="threat-intel-header">
                        <div class="reputation-score-card">
                            <h3>Reputation Score</h3>
                            <div class="reputation-gauge">
                                <svg viewBox="0 0 200 120">
                                    <!-- Gauge background -->
                                    <path d="M 20 100 A 80 80 0 0 1 180 100" stroke="#e0e0e0" stroke-width="20" fill="none" />
                                    <!-- Gauge fill -->
                                    <path id="threat-gauge-fill" d="M 20 100 A 80 80 0 0 1 180 100" stroke="#4caf50" stroke-width="20" fill="none" stroke-linecap="round" />
                                    <!-- Center circle -->
                                    <circle cx="100" cy="100" r="12" fill="#333" />
                                    <!-- Needle -->
                                    <line id="threat-gauge-needle" x1="100" y1="100" x2="100" y2="30" stroke="#333" stroke-width="2" />
                                </svg>
                                <div id="threat-score-text" class="score-text">0/100</div>
                                <div id="threat-level-text" class="threat-level-text">minimal</div>
                            </div>
                        </div>

                        <!-- Quick Stats -->
                        <div class="threat-quick-stats">
                            <div class="stat-box">
                                <span class="stat-label">Total Events</span>
                                <span id="threat-total-events" class="stat-value">0</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">Attack Rate</span>
                                <span id="threat-attack-rate" class="stat-value">0/min</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">Protocols</span>
                                <span id="threat-protocols" class="stat-value">0</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">Known Threat</span>
                                <span id="threat-known-status" class="stat-value threat-unknown">No</span>
                            </div>
                        </div>
                    </div>

                    <!-- WHOIS Information -->
                    <div class="threat-intel-grid">
                        <div class="threat-card whois-card">
                            <h3>üåê WHOIS Information</h3>
                            <div class="whois-content">
                                <div class="whois-row">
                                    <span class="whois-label">IP:</span>
                                    <span id="threat-whois-ip" class="whois-value">-</span>
                                </div>
                                <div class="whois-row">
                                    <span class="whois-label">Hostname:</span>
                                    <span id="threat-whois-hostname" class="whois-value">-</span>
                                </div>
                                <div class="whois-row">
                                    <span class="whois-label">Organization:</span>
                                    <span id="threat-whois-org" class="whois-value">-</span>
                                </div>
                                <div class="whois-row">
                                    <span class="whois-label">ASN:</span>
                                    <span id="threat-whois-asn" class="whois-value">-</span>
                                </div>
                                <div class="whois-row">
                                    <span class="whois-label">Country:</span>
                                    <span id="threat-whois-country" class="whois-value">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Threat Indicators -->
                        <div class="threat-card indicators-card">
                            <h3>‚ö†Ô∏è Threat Indicators</h3>
                            <div id="threat-indicators-list" class="indicators-list">
                                <div class="indicator-placeholder">No threat indicators</div>
                            </div>
                        </div>

                        <!-- Threat Feeds -->
                        <div class="threat-card feeds-card">
                            <h3>üìã Threat Feeds</h3>
                            <div id="threat-feeds-list" class="feeds-list">
                                <div class="feed-placeholder">Not found in threat feeds</div>
                            </div>
                        </div>

                        <!-- Botnet Analysis -->
                        <div class="threat-card botnet-card">
                            <h3>ü§ñ Botnet Analysis</h3>
                            <div id="threat-botnet-info" class="botnet-info">
                                <div class="botnet-placeholder">No botnet activity detected</div>
                            </div>
                        </div>
                    </div>

                    <!-- Score Breakdown -->
                    <div class="score-breakdown-section">
                        <h3>üìä Reputation Score Breakdown</h3>
                        <div id="threat-score-factors" class="score-factors">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>

                    <!-- Top Threats List -->
                    <div class="top-threats-section">
                        <h3>üî¥ Top Threatening IPs</h3>
                        <div id="threat-top-list" class="threats-table-container">
                            <div class="table-placeholder">Loading top threats...</div>
                        </div>
                    </div>
                </div>

                <!-- No Results Message -->
                <div id="threat-intel-no-results" class="threat-intel-message">
                    <p>Enter an IP address to analyze its threat level and reputation.</p>
                </div>
            </section>

            <!-- Export Section -->
            <section class="section export-section" data-section="export">
                <h2>üíæ Export Data</h2>
                <p class="section-description">Download attack data and statistics in various formats</p>
                <div class="export-grid">
                    <div class="export-card">
                        <h3>üìä Events</h3>
                        <p>Recent attack events</p>
                        <div class="export-buttons">
                            <button id="export-events-csv" class="export-btn primary">CSV</button>
                            <button id="export-events-json" class="export-btn">JSON</button>
                        </div>
                    </div>
                    <div class="export-card">
                        <h3>üìà Statistics</h3>
                        <p>Attack statistics summary</p>
                        <div class="export-buttons">
                            <button id="export-stats-json" class="export-btn primary">JSON</button>
                        </div>
                    </div>
                    <div class="export-card">
                        <h3>üéØ IP Profiles</h3>
                        <p>Attacker profiles and history</p>
                        <div class="export-buttons">
                            <button id="export-profiles-json" class="export-btn primary">JSON</button>
                        </div>
                    </div>
                    <div class="export-card">
                        <h3>üìã Full Report</h3>
                        <p>Comprehensive attack report</p>
                        <div class="export-buttons">
                            <button id="export-report-json" class="export-btn primary">JSON</button>
                        </div>
                    </div>
                </div>
                <div id="export-status" class="export-status" style="display:none;"></div>
            </section>

            <!-- README Section -->
            <section class="section readme-section" data-section="readme">
                <h2>üìñ About DDoSPoT</h2>
                <div class="readme-content">
                    <div class="readme-grid">
                        <div class="readme-card">
                            <div class="readme-icon">üçØ</div>
                            <h3>Advanced Honeypot</h3>
                            <p>Emulates vulnerable UDP/TCP services to detect and analyze DDoS amplification attacks in real-time.</p>
                        </div>
                        <div class="readme-card">
                            <div class="readme-icon">üìä</div>
                            <h3>Real-time Analysis</h3>
                            <p>Interactive dashboard with live attack visualization, geolocation tracking, and protocol breakdown.</p>
                        </div>
                        <div class="readme-card">
                            <div class="readme-icon">ü§ñ</div>
                            <h3>ML Detection</h3>
                            <p>Machine learning models predict attack types and identify anomalous patterns automatically.</p>
                        </div>
                        <div class="readme-card">
                            <div class="readme-icon">üîî</div>
                            <h3>Alert System</h3>
                            <p>Multi-channel notifications (email, Slack, webhooks) for critical attacks and thresholds.</p>
                        </div>
                    </div>
                    
                    <div class="readme-features">
                        <h3>Key Features</h3>
                        <ul class="features-list">
                            <li><span>üîç</span> Protocol detection (HTTP, SSH, DNS, NTP, SSDP)</li>
                            <li><span>üåê</span> Geolocation with ISP and autonomous system data</li>
                            <li><span>üìà</span> Prometheus metrics export for monitoring</li>
                            <li><span>üõ°Ô∏è</span> Token authentication and rate limiting</li>
                            <li><span>üíæ</span> SQLite database with full event history</li>
                            <li><span>üê≥</span> Docker/Docker Compose deployment support</li>
                        </ul>
                    </div>

                    <div class="readme-info">
                        <p><strong>‚ö†Ô∏è Disclaimer:</strong> This project is for research, educational, and defensive purposes only. Do not use it to launch attacks. The author is not responsible for misuse.</p>
                    </div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>DDoSPot Advanced - Professional-Grade Honeypot Monitoring | Updated: <span id="last-update">-</span></p>
        </footer>
    </div>

    <!-- Layout Settings Modal -->
    <div id="layout-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Dashboard Layout Settings</h2>
                <button class="modal-close" id="modal-close">‚úï</button>
            </div>
            <div class="modal-body">
                <h3>Show/Hide Sections</h3>
                <div class="section-toggles">
                    <label class="toggle-item">
                        <input type="checkbox" name="section-alerts" class="section-toggle" checked> üîî Recent Alerts
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-reports" class="section-toggle" checked> üìä Attack Pattern Reports
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-charts" class="section-toggle" checked> üìà Attack Timeline & Protocol
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-heatmap" class="section-toggle" checked> üî• Attack Intensity Heatmap
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-attackers" class="section-toggle" checked> üî¥ Top Attacking IPs
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-blacklist" class="section-toggle" checked> üö´ Active Blacklist
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-events" class="section-toggle" checked> üì° Recent Attack Events
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-logs" class="section-toggle" checked> üì∫ Real-Time Log Viewer
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-anomaly" class="section-toggle" checked> ü§ñ ML Anomaly Detection
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-database" class="section-toggle" checked> üíæ Database Information
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-map" class="section-toggle" checked> üåç Geographic Heat Map
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-threat" class="section-toggle" checked> ‚ö†Ô∏è Threat Intelligence
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-response" class="section-toggle" checked> üõ°Ô∏è Automated Response Actions
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-export" class="section-toggle" checked> üíæ Export Data
                    </label>
                    <label class="toggle-item">
                        <input type="checkbox" name="section-readme" class="section-toggle" checked> üìñ About DDoSPoT
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button id="reset-layout-btn" class="action-btn secondary">‚Ü∫ Reset to Default</button>
                <button id="close-layout-btn" class="action-btn primary">‚úì Done</button>
            </div>
        </div>
    </div>

    <!-- Alert Settings Modal -->
    <div id="alert-settings-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content alert-settings-modal">
            <div class="modal-header">
                <h2>Configure Alert Thresholds</h2>
                <button class="modal-close" id="alert-modal-close">‚úï</button>
            </div>
            <div class="modal-body">
                <!-- Notification Channels -->
                <div class="settings-section">
                    <h3>üì¢ Notification Channels</h3>
                    <div class="channel-toggles">
                        <label class="toggle-item">
                            <input type="checkbox" id="alert-channel-email" class="alert-channel" checked> Email
                        </label>
                        <label class="toggle-item">
                            <input type="checkbox" id="alert-channel-discord" class="alert-channel"> Discord
                        </label>
                        <label class="toggle-item">
                            <input type="checkbox" id="alert-channel-telegram" class="alert-channel"> Telegram
                        </label>
                    </div>
                </div>

                <!-- Event Rate Threshold -->
                <div class="settings-section">
                    <h3>‚ö° Event Rate Threshold</h3>
                    <label class="threshold-control">
                        <span>Events per minute to trigger alert:</span>
                        <div class="input-group">
                            <input type="range" id="alert-events-threshold" class="threshold-slider" min="10" max="500" value="50" step="10">
                            <input type="number" id="alert-events-input" class="threshold-input" min="10" max="500" value="50" step="10">
                            <span class="unit">events/min</span>
                        </div>
                    </label>
                </div>

                <!-- Unique IP Threshold -->
                <div class="settings-section">
                    <h3>üéØ Unique IP Threshold</h3>
                    <label class="threshold-control">
                        <span>Unique attacking IPs to trigger alert:</span>
                        <div class="input-group">
                            <input type="range" id="alert-unique-ips-threshold" class="threshold-slider" min="5" max="200" value="20" step="5">
                            <input type="number" id="alert-unique-ips-input" class="threshold-input" min="5" max="200" value="20" step="5">
                            <span class="unit">IPs</span>
                        </div>
                    </label>
                </div>

                <!-- Attack Duration Threshold -->
                <div class="settings-section">
                    <h3>‚è±Ô∏è Attack Duration Threshold</h3>
                    <label class="threshold-control">
                        <span>Minutes of sustained attack to trigger alert:</span>
                        <div class="input-group">
                            <input type="range" id="alert-duration-threshold" class="threshold-slider" min="1" max="60" value="5" step="1">
                            <input type="number" id="alert-duration-input" class="threshold-input" min="1" max="60" value="5" step="1">
                            <span class="unit">minutes</span>
                        </div>
                    </label>
                </div>

                <!-- Severity Alert Levels -->
                <div class="settings-section">
                    <h3>üé® Alert Severity Levels</h3>
                    <div class="severity-toggles">
                        <label class="toggle-item">
                            <input type="checkbox" class="alert-severity" value="critical" checked> üî¥ Critical
                        </label>
                        <label class="toggle-item">
                            <input type="checkbox" class="alert-severity" value="high" checked> üü† High
                        </label>
                        <label class="toggle-item">
                            <input type="checkbox" class="alert-severity" value="medium" checked> üü° Medium
                        </label>
                        <label class="toggle-item">
                            <input type="checkbox" class="alert-severity" value="low"> üü¢ Low
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="reset-alerts-btn" class="action-btn secondary">‚Ü∫ Reset to Default</button>
                <button id="save-alerts-btn" class="action-btn primary">üíæ Save Settings</button>
            </div>
            <div id="alert-settings-message" class="settings-message" style="display:none;"></div>
        </div>
    </div>

    <!-- IP Action Modal -->
    <div id="ip-action-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Actions for <span id="action-ip-display">-</span></h2>
                <button class="modal-close" id="action-modal-close">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="action-buttons-grid">
                    <button id="action-view-profile" class="action-modal-btn primary">
                        <div class="action-icon">üëÅÔ∏è</div>
                        <div class="action-label">View Profile</div>
                        <div class="action-desc">Detailed attacker information</div>
                    </button>
                    <button id="action-blacklist-btn" class="action-modal-btn danger">
                        <div class="action-icon">üö´</div>
                        <div class="action-label">Add to Blacklist</div>
                        <div class="action-desc">Block this IP permanently</div>
                    </button>
                    <button id="action-whitelist-btn" class="action-modal-btn success">
                        <div class="action-icon">‚úÖ</div>
                        <div class="action-label">Add to Whitelist</div>
                        <div class="action-desc">Trust this IP</div>
                    </button>
                    <button id="action-block-country-btn" class="action-modal-btn warning">
                        <div class="action-icon">üåç</div>
                        <div class="action-label">Block Country</div>
                        <div class="action-desc">Block all IPs from this country</div>
                    </button>
                </div>
                <div id="action-message" class="action-message" style="display:none;"></div>
            </div>
        </div>
    </div>

    <!-- IP Profile Modal -->
    <div id="ip-profile-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content profile-modal">
            <div class="modal-header">
                <h2>IP Profile: <span id="profile-ip-display">-</span></h2>
                <button class="modal-close" id="profile-modal-close">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="profile-grid">
                    <div class="profile-item">
                        <label>Total Events:</label>
                        <span id="profile-events">-</span>
                    </div>
                    <div class="profile-item">
                        <label>Attack Type:</label>
                        <span id="profile-type">-</span>
                    </div>
                    <div class="profile-item">
                        <label>Rate/Min:</label>
                        <span id="profile-rate">-</span>
                    </div>
                    <div class="profile-item">
                        <label>Severity:</label>
                        <span id="profile-severity">-</span>
                    </div>
                    <div class="profile-item">
                        <label>Protocols:</label>
                        <span id="profile-protocols">-</span>
                    </div>
                    <div class="profile-item">
                        <label>Country:</label>
                        <span id="profile-country">-</span>
                    </div>
                    <div class="profile-item">
                        <label>ISP:</label>
                        <span id="profile-isp">-</span>
                    </div>
                    <div class="profile-item">
                        <label>Risk Score:</label>
                        <span id="profile-risk">-</span>
                    </div>
                </div>
                <div class="profile-section">
                    <h3>Recent Events</h3>
                    <div id="profile-recent-events" class="profile-events-list">
                        <div class="loading">Loading events...</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="profile-close-btn" class="action-btn primary">‚úì Close</button>
            </div>
        </div>
    </div>

    <script>
        // Connection health check and initialization helper
        (function() {
            console.log('[Health Check] Starting connection verification...');
            
            // Check if APIs are accessible
            const checkConnection = async () => {
                try {
                    const response = await fetch('/api/stats', { timeout: 5000 });
                    if (response.ok) {
                        const el = document.getElementById('status-indicator');
                        const txt = document.getElementById('status-text');
                        if (el) el.classList.add('healthy');
                        if (txt) txt.textContent = 'Connected';
                        console.log('[Health Check] ‚úì API is responding correctly');
                        return true;
                    }
                } catch (e) {
                    console.error('[Health Check] ‚úó Connection failed:', e.message);
                    const txt = document.getElementById('status-text');
                    if (txt) txt.textContent = 'Connection Error';
                }
                return false;
            };
            
            // Run check after small delay
            setTimeout(() => {
                checkConnection().catch(err => console.error('Health check error:', err));
            }, 500);
        })();
    </script>
    <script src="/static/dashboard.js?v=20260131f"></script>
</body>
</html>
